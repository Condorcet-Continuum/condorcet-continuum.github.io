---
import { getCollection } from 'astro:content';
import BaseHead from '../../components/BaseHead.astro';
import Header from '../../components/Header.astro';
import Footer from '../../components/Footer.astro';

// 1. Génère les chemins pour tous les fichiers .md du dossier 'docs'
export async function getStaticPaths() {
  const docsEntries = await getCollection('docs');
  return docsEntries.map((entry) => ({
    params: { slug: entry.slug },
    props: { entry },
  }));
}

const { entry } = Astro.props;
const { Content } = await entry.render();

// 2. Récupère tous les titres pour la Sidebar (triés par ordre)
const allDocs = (await getCollection('docs')).sort((a, b) => a.data.order - b.data.order);
---

<!doctype html>
<html lang="fr" class="scroll-smooth">
  <head>
    <BaseHead
      title={`${entry.data.title} | Documentation`}
      description={entry.data.description || 'Documentation technique'}
    />
  </head>
  <body class="bg-slate-50 text-slate-900 font-sans antialiased">
    <Header />

    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12 flex flex-col md:flex-row gap-12">
      <aside class="md:w-64 shrink-0">
        <nav class="sticky top-32">
          <h3 class="font-bold text-slate-900 mb-4 uppercase tracking-widest text-xs">
            Menu Documentation
          </h3>
          <ul class="space-y-2 border-l border-slate-200">
            {
              allDocs.map((doc) => (
                <li>
                  <a
                    href={`/docs/${doc.slug}`}
                    class={`block pl-4 py-1 text-sm border-l-2 transition-colors ${
                      entry.slug === doc.slug
                        ? 'border-rust text-rust font-bold'
                        : 'border-transparent text-slate-600 hover:text-slate-900 hover:border-slate-300'
                    }`}
                  >
                    {doc.data.title}
                  </a>
                </li>
              ))
            }
          </ul>
        </nav>
      </aside>

      <main class="flex-1 min-w-0">
        <article
          class="prose prose-slate max-w-none prose-headings:font-bold prose-headings:text-slate-900 prose-a:text-rust prose-code:text-rust prose-pre:bg-slate-900 prose-pre:shadow-xl rounded-xl"
        >
          <h1 class="text-4xl font-extrabold mb-4">{entry.data.title}</h1>
          <Content />
        </article>
      </main>
    </div>
    <Footer />
  </body>
</html>
